<app-navbar></app-navbar>
<app-sidenav></app-sidenav>

<div class="page-content">
  <div class="inventory-wrapper">

    <!-- Barra de botones -->
    <div class="toolbar">
      <button class="btn btn-add" (click)="openAddForm()" [disabled]="loading">
        + Agregar un producto
      </button>

      <button class="btn btn-edit"
              (click)="toggleEditMode()"
              [disabled]="loading || deleteMode || products.length === 0">
        {{ editMode ? 'Guardar cambios' : 'ðŸ”„ Actualizar productos' }}
      </button>

      <button class="btn btn-delete"
              (click)="onDeleteButton()"
              [disabled]="loading || editMode || products.length === 0">
        {{ deleteMode ? 'Confirmar eliminaciÃ³n' : 'Eliminar productos' }}
      </button>
    </div>

    <!-- Tabla -->
    <div class="table-container" *ngIf="!loading; else loadingTpl">

      <table class="inventory-table">
        <thead>
          <tr>
            <th *ngIf="deleteMode" class="col-select"></th>
            <th>Nombre</th>
            <th>Stock</th>
            <th>Precio 1</th>
            <th>Precio 2</th>
            <th>Precio 3</th>
            <th>Precio 4</th>
          </tr>
        </thead>

        <tbody>
          <!-- Sin productos -->
          <tr *ngIf="products.length === 0">
            <td [attr.colspan]="deleteMode ? 7 : 6" class="empty-cell">
              TodavÃ­a no hay productos cargados.
            </td>
          </tr>

          <!-- Con productos -->
          <tr *ngFor="let p of (editMode ? editedProducts : products); let i = index">
            <!-- checkbox sÃ³lo en delete -->
            <td *ngIf="deleteMode" class="col-select">
              <input type="checkbox"
                     [checked]="isSelected(p.id)"
                     (change)="toggleSelected(p.id, $event.target.checked)" />
            </td>

            <!-- Nombre -->
            <td>
              <ng-container *ngIf="editMode; else nameRead">
                <input type="text"
                       [(ngModel)]="editedProducts[i].title"
                       class="cell-input" />
              </ng-container>
              <ng-template #nameRead>
                {{ p.title }}
              </ng-template>
            </td>

            <!-- Stock -->
            <td>
              <ng-container *ngIf="editMode; else stockRead">
                <input type="number"
                       min="0"
                       [(ngModel)]="editedProducts[i].stock"
                       class="cell-input number" />
              </ng-container>
              <ng-template #stockRead>
                {{ p.stock }}
              </ng-template>
            </td>

            <!-- Precio 1 -->
            <td>
              <ng-container *ngIf="editMode; else price1Read">
                <input type="number"
                       min="0"
                       step="0.01"
                       [(ngModel)]="editedProducts[i].price"
                       class="cell-input number" />
              </ng-container>
              <ng-template #price1Read>
                {{ p.price | currency:'ARS':'symbol-narrow':'1.2-2' }}
              </ng-template>
            </td>

            <!-- Precio 2 -->
            <td>
              <ng-container *ngIf="editMode; else price2Read">
                <input type="number"
                       min="0"
                       step="0.01"
                       [(ngModel)]="editedProducts[i].price2"
                       class="cell-input number" />
              </ng-container>
              <ng-template #price2Read>
                {{ p.price2 | currency:'ARS':'symbol-narrow':'1.2-2' }}
              </ng-template>
            </td>

            <!-- Precio 3 -->
            <td>
              <ng-container *ngIf="editMode; else price3Read">
                <input type="number"
                       min="0"
                       step="0.01"
                       [(ngModel)]="editedProducts[i].price3"
                       class="cell-input number" />
              </ng-container>
              <ng-template #price3Read>
                {{ p.price3 | currency:'ARS':'symbol-narrow':'1.2-2' }}
              </ng-template>
            </td>

            <!-- Precio 4 -->
            <td>
              <ng-container *ngIf="editMode; else price4Read">
                <input type="number"
                       min="0"
                       step="0.01"
                       [(ngModel)]="editedProducts[i].price4"
                       class="cell-input number" />
              </ng-container>
              <ng-template #price4Read>
                {{ p.price4 | currency:'ARS':'symbol-narrow':'1.2-2' }}
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>

      <!-- Cancelar ediciÃ³n -->
      <div class="edit-actions" *ngIf="editMode">
        <button class="btn btn-cancel" (click)="cancelEdit()" [disabled]="loading">
          Cancelar cambios
        </button>
      </div>
    </div>

    <ng-template #loadingTpl>
      <div class="loading-text">Cargando inventario...</div>
    </ng-template>
  </div>
</div>

<!-- ðŸ”¹ MODAL PARA AGREGAR PRODUCTO -->
<div class="modal-backdrop" *ngIf="showAddForm">
  <div class="modal-card">
    <h2>Agregar producto</h2>

    <label>
      Nombre del producto *
      <input type="text"
             [(ngModel)]="newProduct.title"
             placeholder="Ej: Coca Cola lata"
             class="modal-input" />
    </label>

    <label>
      Stock inicial
      <input type="number"
             min="0"
             [(ngModel)]="newProduct.stock"
             class="modal-input" />
    </label>

    <label>
      Precio 1
      <input type="number"
             min="0"
             step="0.01"
             [(ngModel)]="newProduct.price"
             class="modal-input" />
    </label>

    <label>
      Precio 2
      <input type="number"
             min="0"
             step="0.01"
             [(ngModel)]="newProduct.price2"
             class="modal-input" />
    </label>

    <label>
      Precio 3
      <input type="number"
             min="0"
             step="0.01"
             [(ngModel)]="newProduct.price3"
             class="modal-input" />
    </label>

    <label>
      Precio 4
      <input type="number"
             min="0"
             step="0.01"
             [(ngModel)]="newProduct.price4"
             class="modal-input" />
    </label>

    <div class="modal-actions">
      <button class="btn btn-cancel" type="button" (click)="closeAddForm()" [disabled]="loading">
        Cancelar
      </button>
      <button class="btn btn-add" type="button" (click)="saveNewProduct()" [disabled]="loading">
        Guardar
      </button>
    </div>
  </div>
</div>
